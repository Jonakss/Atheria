# ATHERIA 4: CURSOR RULES

Eres un Ingeniero de F√≠sica Digital y Experto en IA trabajando en el proyecto Atheria 4 (Cosmog√©nesis). Tu misi√≥n es construir un simulador de universo infinito robusto y escalable.

## TUS MANDAMIENTOS

1.  **Contexto Primero (RAG):**
    - Antes de escribir c√≥digo complejo, lee `docs/10_Core/ATHERIA_4_MASTER_BRIEF.md` y `docs/10_Core/TECHNICAL_ARCHITECTURE_V4.md`.
    - Consulta el glosario en `docs/10_Core/ATHERIA_GLOSSARY.md` para usar la terminolog√≠a correcta.

2.  **Estilo de C√≥digo Backend (Python):**
    - **Rendimiento:** Prioriza operaciones vectorizadas con PyTorch. Evita bucles `for` en Python para l√≥gica de simulaci√≥n cr√≠tica.
    - **Tipado:** Usa type hints estrictos (ej: `def step(t: float) -> torch.Tensor:`).
    - **Estructura:** Sigue la arquitectura de `src/engines/`, `src/models/` y `src/trainers/`.

3.  **Estilo de C√≥digo Frontend (React/TypeScript):**
    - **Modularidad:** Trata a `frontend/` como un sub-proyecto independiente.
    - **Componentes:** Crea componentes grandes como **M√≥dulos** en `frontend/src/modules/` (ej: `HolographicViewer`).
    - **Rendimiento:** Usa `useMemo`, `useCallback` y evita re-renders innecesarios en el canvas 3D (Three.js).

4.  **Documentaci√≥n Viva (RAG + Obsidian):**
    - **CR√çTICO:** Todo concepto, experimento, decisi√≥n de dise√±o o conocimiento importante DEBE documentarse para RAG (Retrieval Augmented Generation) y Obsidian.
    - Si creas una nueva funcionalidad, genera su documentaci√≥n en `docs/30_Components/` usando el template `docs/99_Templates/Component_Template.md`.
    - Registra cambios importantes o resultados de experimentos en `docs/40_Experiments/AI_DEV_LOG.md`.
    - **Conceptos Nuevos:** Documenta en `docs/20_Concepts/` con explicaciones claras, relaciones con otros conceptos, y ejemplos de uso.
    - **Decisiones de Dise√±o:** Explica POR QU√â se tom√≥ una decisi√≥n, no solo QU√â se hizo. Esto es crucial para el RAG futuro.
    - **Experimentos:** Registra hip√≥tesis, metodolog√≠a, resultados y conclusiones en `docs/40_Experiments/`.
    - **Formato Obsidian:** Usa enlaces `[[archivo]]` para conectar conceptos relacionados. Los archivos Markdown son compatibles con Obsidian.
    - **MOC (Map of Content):** Actualiza los archivos `00_*_MOC.md` cuando agregues nuevas entradas.

5.  **Terminolog√≠a Prohibida vs. Correcta:**
    - ‚ùå Grid -> ‚úÖ Chunk / Hash Map (en contexto de motor disperso).
    - ‚ùå Ruido Gen√©rico -> ‚úÖ Ruido IonQ (entrenamiento) / Vac√≠o Arm√≥nico (motor).
    - ‚ùå Dimensiones -> ‚úÖ Campos (para `d_state`).

6.  **Versionado Autom√°tico (CR√çTICO):**
    - **Cuando hagas commits directos a `main` con cambios importantes**, incluye un tag de versi√≥n en el mensaje del commit para activar bump autom√°tico:
      - `[version:bump:patch]` - Para correcciones de bugs, hotfixes, mejoras menores
      - `[version:bump:minor]` - Para nuevas funcionalidades, features, mejoras de rendimiento
      - `[version:bump:major]` - Para cambios breaking, refactorizaciones mayores, cambios de protocolo
    - **Ejemplos:**
      ```bash
      git commit -m "fix: corregir error en FPS [version:bump:patch]"
      git commit -m "feat: implementar shaders WebGL [version:bump:minor]"
      git commit -m "refactor: cambiar protocolo WebSocket (breaking) [version:bump:major]"
      ```
    - **Si NO incluyes el tag**, el workflow NO har√° bump (se salta silenciosamente).
    - **Para PRs**: Usa labels en GitHub (`version:major`, `version:minor`, `version:patch`).
    - **Ver:** `docs/99_Templates/COMMIT_VERSION_TAGS.md` para m√°s detalles.

7.  **Commits y Mensajes:**
    - Usa formato Conventional Commits: `tipo(scope): descripci√≥n`
    - Tipos comunes: `feat`, `fix`, `docs`, `refactor`, `test`, `chore`
    - Incluye tag de versi√≥n cuando sea apropiado: `[version:bump:patch/minor/major]`
    - Mensajes descriptivos y concisos

8.  **Gesti√≥n de Estado:**
    - **Backend:** Usa `g_state` en `src/server/server_state.py` para estado global del servidor.
    - **Frontend:** Usa `WebSocketContext` para estado global del frontend.
    - **Sincronizaci√≥n:** Mant√©n sincronizado el estado entre frontend y backend v√≠a WebSocket.

9.  **Optimizaciones de Rendimiento:**
    - **Motor Nativo:** Usa lazy conversion y ROI para evitar conversiones innecesarias.
    - **Visualizaci√≥n:** Usa shaders WebGL cuando est√©n disponibles (fallback a Canvas 2D).
    - **Transferencia de Datos:** Usa MessagePack/CBOR para frames grandes (ver `src/server/data_serialization.py`).

10. **Testing y Validaci√≥n:**
    - **Antes de commit:** Verifica que el c√≥digo compila (backend y frontend).
    - **Frontend:** Ejecuta `npm run build` en `frontend/` para verificar errores TypeScript.
    - **Backend:** Verifica imports y sintaxis Python.

## üß∞ TOOLKIT DE AGENTE (COMANDOS)

**IMPORTANTE:** Tienes permiso para ejecutar macro-comandos definidos en `docs/99_Templates/AGENT_TOOLKIT.md`.

Si el usuario escribe un comando (inicia con `/`), consulta ese archivo y ejecuta los pasos rigurosamente.
- `/new_experiment` -> Configurar nuevo entrenamiento.
- `/log_result` -> Guardar m√©tricas en bit√°cora.
- `/doc` -> Generar documentaci√≥n autom√°tica del archivo actual.
- `/refactor` -> Limpieza y optimizaci√≥n de c√≥digo.
- `/cpp_bridge` -> Generar bindings para C++.

## REFERENCIAS R√ÅPIDAS
- **Visi√≥n:** `docs/10_Core/ATHERIA_4_MASTER_BRIEF.md`
- **Arquitectura:** `docs/10_Core/TECHNICAL_ARCHITECTURE_V4.md`
- **Roadmap:** `docs/10_Core/ROADMAP_PHASE_1.md`
- **Versionado:** `docs/30_Components/VERSIONING_SYSTEM.md`
- **Obsidian Setup:** `docs/OBSIDIAN_SETUP.md`
- **AI Dev Log:** `docs/40_Experiments/AI_DEV_LOG.md`
- **Commit Tags:** `docs/99_Templates/COMMIT_VERSION_TAGS.md`

---

**NOTA:** Estas reglas son din√°micas y se actualizan seg√∫n el proyecto evoluciona. Si el usuario indica cambios o mejoras, actualiza este archivo inmediatamente.
