# Holographic Volume Viewer Implementation Log

**Date**: 2025-12-03  
**Type**: Feature Implementation  
**Scope**: Frontend + Backend

## Overview

Implemented `HolographicVolumeViewer` component to render the 3D "Bulk" volumetric data generated by `HolographicEngine.get_bulk_state()`. This allows visualization of the Scale-Space projection where depth represents the renormalization scale.

## Design Decisions

### Why a Separate Viewer?

The existing `HolographicViewer` and `HolographicViewer2` render the **2D boundary state** projected onto a Poincaré disk. They do not handle true 3D volumetric data. The new `HolographicVolumeViewer` is specifically designed to:

1. Accept 3D tensor data `[D, H, W]` (Depth × Height × Width)
2. Render each voxel as a particle in 3D space
3. Visualize the "depth" dimension as the Scale/Renormalization axis

### Visualization Technique

**Volumetric Point Cloud** was chosen over:
- **Raymarching**: More expensive computationally, harder to implement for real-time data
- **Isosurfaces**: Would hide internal structure

The point cloud approach allows:
- Sparse rendering (only voxels above threshold)
- Visual depth cues through color and size variation
- Good performance even for large volumes

## Implementation Details

### Frontend Component (`HolographicVolumeViewer.tsx`)

**Location**: `frontend/src/components/visualization/HolographicVolumeViewer.tsx`

**Key Features**:
- **Three.js Scene**: Standard setup with OrbitControls for 3D navigation
- **Color Gradient**: 
  - Boundary (Z=0): Blue
  - Deep Bulk (Z=max): Red
  - Represents the transition from UV (high detail) to IR (coarse-grained)
- **Size Variation**: 
  - Deeper particles are larger
  - Simulates the coarse-graining effect of renormalization
- **Opacity**: Based on voxel intensity to reveal internal structure

**Props**:
```typescript
interface HolographicVolumeViewerProps {
    volumeData: number[];  // Flat array [D * H * W]
    depth: number;         // D dimension
    width: number;         // W dimension  
    height: number;        // H dimension
    threshold?: number;    // Min intensity to render (default 0.01)
}
```

**Shader**:
- **Vertex**: Size attenuation based on camera distance
- **Fragment**: Circular particles with smooth anti-aliased edges

### Backend Handler (`handle_get_bulk_volume`)

**Location**: `src/pipelines/handlers/inference_handlers.py`

**Functionality**:
1. Validates that current motor is `HolographicEngine`
2. Calls `motor.get_bulk_state()` to obtain 3D bulk tensor
3. Converts to CPU and flattens to 1D array
4. Sends via WebSocket with metadata (dimensions, step)

**WebSocket Message**:
```python
{
    "type": "bulk_volume_data",
    "payload": {
        "volume_data": [...],  # Flat array
        "depth": 8,
        "height": 64,
        "width": 64,
        "step": 1234
    }
}
```

**Request Format**:
```json
{
    "type": "get_bulk_volume",
    "ws_id": "..."
}
```

## Integration

### Handler Registration

Added to `HANDLERS` dictionary in `inference_handlers.py`:
```python
"get_bulk_volume": handle_get_bulk_volume
```

### Frontend Integration (Pending)

The component is ready but needs to be integrated into the UI. Suggested approach:
- Add toggle in `PhysicsInspector` or similar UI component
- Switch between "Boundary View" (existing HolographicViewer) and "Bulk View" (new HolographicVolumeViewer)
- Request bulk data when user activates volumetric view

## Verification

- ✅ TypeScript compilation successful
- ✅ Backend handler registered in HANDLERS
- ✅ HolographicEngine has `get_bulk_state()` method
- ⏳ End-to-end testing pending (requires loading HolographicEngine in inference)

## Next Steps

1. **UI Integration**: Add viewer toggle to `PhysicsInspector.tsx`
2. **On-Demand Loading**: Only request bulk data when user activates the view (to avoid overhead)
3. **Caching**: Consider caching bulk data if it's expensive to compute
4. **Alternative Rendering**: Explore WebGL volumetric rendering for better performance with very large volumes

## Files Changed

- `frontend/src/components/visualization/HolographicVolumeViewer.tsx` (NEW)
- `src/pipelines/handlers/inference_handlers.py` (MODIFIED)
- `docs/40_Experiments/AI_DEV_LOG.md` (MODIFIED)
- `docs/30_Components/HOLOGRAPHIC_VOLUME_VIEWER.md` (NEW - Usage guide)

## Related Logs

- [[2025-12-03_holographic_engine_implementation]] - Implementation of the HolographicEngine itself
- [[HOLOGRAPHIC_PRINCIPLE]] - Theoretical background for the holographic approach
